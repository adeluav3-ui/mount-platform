<!DOCTYPE html>
<html>

<head>
    <title>Mobile Debug</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
        }

        .error {
            background: #f8d7da;
        }

        .loading {
            background: #fff3cd;
        }

        button {
            padding: 15px;
            margin: 5px;
            font-size: 16px;
        }
    </style>
</head>

<body>
    <h2>ðŸ“± Mobile Push Debug</h2>

    <div id="status" class="status loading">Loading...</div>

    <button onclick="checkSubscription()">Check Status</button>
    <button onclick="triggerSubscription()">Subscribe Now</button>
    <button onclick="location.reload()">Reload Page</button>

    <div id="result" style="margin-top: 20px; font-family: monospace;"></div>

    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
        window.OneSignalDeferred = window.OneSignalDeferred || [];

        OneSignalDeferred.push(async function (OneSignal) {
            await OneSignal.init({
                appId: "0186919f-3891-40a5-81b6-c9e70634bdef",
                autoRegister: false,
                notifyButton: { enable: false }
            });

            window._OneSignal = OneSignal;
            document.getElementById('status').className = 'status success';
            document.getElementById('status').textContent = 'âœ… OneSignal Loaded';
        });

        async function checkSubscription() {
            if (!window._OneSignal) return;

            const playerId = await window._OneSignal.User.PushSubscription.id;
            const optedIn = await window._OneSignal.User.PushSubscription.optedIn;

            document.getElementById('result').innerHTML = `
                <strong>Player ID:</strong> ${playerId || 'None'}<br>
                <strong>Opted In:</strong> ${optedIn}<br>
                <strong>Permission:</strong> ${Notification.permission}
            `;
        }

        async function triggerSubscription() {
            if (!window._OneSignal) return;

            if (Notification.permission !== 'granted') {
                const perm = await Notification.requestPermission();
                if (perm !== 'granted') {
                    alert('Permission denied');
                    return;
                }
            }

            if (window._OneSignal.registerForPushNotifications) {
                await window._OneSignal.registerForPushNotifications();
                alert('Subscription triggered! Check status in 5 seconds.');
                setTimeout(checkSubscription, 5000);
            }
        }
    </script>
</body>

</html>